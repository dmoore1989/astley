# frozen_string_literal: true

# !/usr/bin/env ruby

require 'thor'

module Astley
  VERSION = '0.1.0'

  # Command-line interface for Astley
  class CLI < Thor
    desc 'version', 'Print the version'
    def version
      puts "Astley version #{VERSION}"
    end

    desc 'list', 'List known projects'
    def list
      require 'yaml'
      config_path = File.expand_path('../../config/projects.yml', __dir__)
      unless File.exist?(config_path)
        puts "Config file not found: #{config_path}"
        exit 1
      end
      config = YAML.load_file(config_path)
      projects = config['projects']&.keys || []
      if projects.empty?
        puts 'No projects found.'
      else
        puts 'Known projects:'
        projects.each { |proj| puts "- #{proj}" }
      end
    end

    desc 'compile PROJECT', 'Compile rules for a project'
    def compile(project)
      # TODO: Implement actual rule compilation logic
      puts "Compiling rules for #{project}..."
    end
  end
end

Astley::CLI.start(ARGV)
